1. Learning Modern 3D Graphics Programming
https://paroj.github.io/gltut/index.html

2. tutouries(OpenGL)
https://github.com/paroj/gltut

3. vulkan intro
https://docs.vulkan.org/tutorial/latest/00_Introduction.html

g++ test.cpp -g -O2 -std=c++17 -lglfw -lvulkan -ldl -lpthread -lX11 -lXxf86vm -lXrandr -lXi -o test

4. architecture:
https://chromium.googlesource.com/external/github.com/KhronosGroup/Vulkan-Loader/+/HEAD/loader/LoaderAndLayerInterface.md

https://github.com/KhronosGroup/Vulkan-Loader/blob/main/docs/LoaderInterfaceArchitecture.md


file:///home/kai/Downloads/vk-1.3-spec.pdf

https://www.mesa3d.org/

https://github.com/glfw/glfw/releases/tag/3.4

https://github.com/KhronosGroup/OpenGL-Registry



cmake -B build/linux -S . -G "Ninja" -DLY_3RDPARTY_PATH=./o3de-packages
cmake --build build/linux --target Editor --config release -j8


[2/739] Building CXX object Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx.o
FAILED: Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx.o 
/bin/g++ -DAZ_BUILD_CONFIGURATION_TYPE=\"profile\" -DAZ_ENABLE_DEBUG_TOOLS -DAZ_ENABLE_TRACING -DAZ_PROFILE_BUILD -DLINUX -DLINUX64 -DNDEBUG -DPAL_TRAIT_LINUX_WINDOW_MANAGER_XCB -D_FORTIFY_SOURCE=2 -D_HAS_EXCEPTIONS=0 -D_PROFILE -D__linux__ -I/mnt/work/o3de/Code/Framework/AzFramework/. -I/mnt/work/o3de/Code/Framework/AzFramework/Platform/Linux -I/mnt/work/o3de/Code/Framework/AzFramework/Platform/Common -I/mnt/work/o3de/Code/Framework/AzFramework/Platform/Common/Xcb -I/mnt/work/o3de/Code/Framework/AzCore/. -I/mnt/work/o3de/Code/Framework/AzCore/Platform/Linux -I/mnt/work/o3de/Code/Framework/AzCore/Platform/Common -I/mnt/work/o3de/Code/Framework/AzNetworking/. -I/mnt/work/o3de/Code/Framework/AzNetworking/Platform/Common -I/mnt/work/o3de/Code/Framework/AzNetworking/Platform/Linux -I/mnt/work/o3de/build/linux/Code/Framework/AzNetworking/Azcg/Generated/AzNetworking -isystem /mnt/work/o3de/o3de-packages/packages/Lua-5.4.4-rev1-linux/Lua/include -isystem /mnt/work/o3de/o3de-packages/packages/RapidJSON-1.1.0-rev1-multiplatform/RapidJSON/include -isystem /mnt/work/o3de/o3de-packages/packages/RapidXML-1.13-rev1-multiplatform/RapidXML/include -isystem /mnt/work/o3de/o3de-packages/packages/zlib-1.2.11-rev5-linux/zlib/include -isystem /mnt/work/o3de/o3de-packages/packages/cityhash-1.1-multiplatform/cityhash/src -isystem /mnt/work/o3de/o3de-packages/packages/lz4-1.9.4-rev2-linux/lz4/include -fno-exceptions -fvisibility=hidden -fvisibility-inlines-hidden -Wall -fpie -fstack-protector-all -Wno-array-bounds -Wno-attributes -Wno-class-memaccess -Wno-delete-non-virtual-dtor -Wno-enum-compare -Wno-format-overflow -Wno-format-truncation -Wno-int-in-bool-context -Wno-logical-not-parentheses -Wno-memset-elt-size -Wno-nonnull-compare -Wno-parentheses -Wno-reorder -Wno-restrict -Wno-sequence-point -Wno-sign-compare -Wno-strict-aliasing -Wno-stringop-overflow -Wno-stringop-truncation -Wno-switch -Wno-uninitialized -Wno-unused-result -msse4.1  -O2 -g -std=c++17 -fPIC -MD -MT Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx.o -MF Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx.o.d -o Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx.o -c /mnt/work/o3de/build/linux/Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx
In file included from /mnt/work/o3de/Code/Framework/AzFramework/Platform/Linux/AzFramework/Components/NativeUISystemComponent_Linux.cpp:17,
                 from /mnt/work/o3de/build/linux/Code/Framework/AzFramework/CMakeFiles/AzFramework.NativeUI.dir/Unity/unity_0_cxx.cxx:10:
/mnt/work/o3de/Code/Framework/AzFramework/Platform/Common/Xcb/AzFramework/XcbInputDeviceMouse.h:17:10: fatal error: xcb/xinput.h: No such file or directory
   17 | #include <xcb/xinput.h>
      |          ^~~~~~~~~~~~~~
compilation terminated.

sudo apt install libxcb-xinput-dev


project build:
cmake -B build/linux -S . -GNinja Multi-Config -DLY_3RDPARTY_PATH=/home/kai/o3deprj/.o3de/3rdParty
cmake --build build/linux --target MyProject.GameLauncher MyProject.HeadlessServerLauncher MyProject.ServerLauncher MyProject.UnifiedLauncher Editor --config release -j8




pass create -> ProducerScope() -> Factory::Get().CreateScope()(SystemComponent) -> Vulkan::Scope::Create()

print_stack()
AZ::Vulkan::CommandList::Submit(AZ::RHI::CopyItem const&, unsigned int)
AZ::Vulkan::BufferPoolResolver::Resolve(AZ::Vulkan::CommandList&)
AZ::Vulkan::Scope::Begin(AZ::Vulkan::CommandList&) const
AZ::Vulkan::FrameGraphExecuteGroupPrimary::BeginContextInternal(AZ::RHI::FrameGraphExecuteContext&, unsigned int)
AZ::RHI::FrameGraphExecuteGroup::BeginContext(unsigned int)
AZ::RHI::FrameScheduler::ExecuteContextInternal(AZ::RHI::FrameGraphExecuteGroup&, unsigned int)
AZ::RHI::FrameScheduler::ExecuteGroupInternal(AZ::Job*, unsigned int)
AZ::Internal::JobManagerBase::Process(AZ::Job*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsInternal(AZ::Internal::JobManagerWorkStealing::ThreadInfo*, AZ::Job*, std::atomic<bool>*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsWorker(AZ::Internal::JobManagerWorkStealing::ThreadInfo*)
AZStd::Internal::thread_run_function(void*)
[bt] #13 /lib/x86_64-linux-gnu/libc.so.6(clone+0x42) [0x7fe7f4d9f352]

print_stack()
AZ::Vulkan::CommandList::ClearImage(AZ::Vulkan::CommandList::ResourceClearRequest const&)
AZ::Vulkan::Scope::ProcessClearRequests(AZ::Vulkan::CommandList&) const
AZ::Vulkan::FrameGraphExecuteGroupPrimary::BeginContextInternal(AZ::RHI::FrameGraphExecuteContext&, unsigned int)
AZ::RHI::FrameGraphExecuteGroup::BeginContext(unsigned int)
AZ::RHI::FrameScheduler::ExecuteContextInternal(AZ::RHI::FrameGraphExecuteGroup&, unsigned int)
AZ::RHI::FrameScheduler::ExecuteGroupInternal(AZ::Job*, unsigned int)
AZ::Internal::JobManagerBase::Process(AZ::Job*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsInternal(AZ::Internal::JobManagerWorkStealing::ThreadInfo*, AZ::Job*, std::atomic<bool>*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsWorker(AZ::Internal::JobManagerWorkStealing::ThreadInfo*)
AZStd::Internal::thread_run_function(void*)
[bt] #12 /lib/x86_64-linux-gnu/libc.so.6(clone+0x42) [0x7fe7f4d9f352]


print_stack()
AZ::Vulkan::CommandList::Submit(AZ::RHI::DispatchItem const&, unsigned int)
AZ::RPI::RenderPass::BuildCommandList(AZ::RHI::FrameGraphExecuteContext const&)
AZ::RHI::FrameScheduler::ExecuteContextInternal(AZ::RHI::FrameGraphExecuteGroup&, unsigned int)
AZ::RHI::FrameScheduler::ExecuteGroupInternal(AZ::Job*, unsigned int)
AZ::Internal::JobManagerBase::Process(AZ::Job*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsInternal(AZ::Internal::JobManagerWorkStealing::ThreadInfo*, AZ::Job*, std::atomic<bool>*)
AZ::Internal::JobManagerWorkStealing::ProcessJobsWorker(AZ::Internal::JobManagerWorkStealing::ThreadInfo*)
AZStd::Internal::thread_run_function(void*)
[bt] #10 /lib/x86_64-linux-gnu/libc.so.6(clone+0x42) [0x7fe7f4d9f352]

AZ::Vulkan::Queue::SubmitCommandBuffers(AZStd::vector<AZStd::intrusive_ptr<AZ::Vulkan::CommandList>, AZStd::allocator> const&, AZStd::vector<AZStd::pair<unsigned int, AZStd::intrusive_ptr<AZ::Vulkan::Semaphore> >, AZStd::allocator> const&, AZStd::vector<AZStd::intrusive_ptr<AZ::Vulkan::Semaphore>, AZStd::allocator> const&, AZStd::vector<AZStd::intrusive_ptr<AZ::Vulkan::Fence>, AZStd::allocator> const&, AZ::Vulkan::Fence*)
void AZStd::Internal::function_util::get_invoker<void (void*), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::Vulkan::CommandQueue::Signal(AZ::Vulkan::Fence&)::{lambda(void*)#1}>(AZStd::Internal::function_util::function_buffer&, void*&&)
AZ::RHI::CommandQueue::QueueCommand(AZStd::function<void (void*)>)
AZ::Vulkan::CommandQueue::Signal(AZ::Vulkan::Fence&)
void AZStd::Internal::function_util::get_invoker<void (void*), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::Vulkan::AsyncUploadQueue::QueueUpload(AZ::RHI::StreamingImageExpandRequestTemplate<AZ::RHI::Image> const&, unsigned int)::{lambda(void*)#1}>(AZStd::Internal::function_util::function_buffer&, void*&&)
AZ::RHI::CommandQueue::ProcessQueue()
AZStd::Internal::thread_run_function(void*)
[bt] #8 /lib/x86_64-linux-gnu/libc.so.6(clone+0x42) [0x7fe7f4d9f352]


// Buffer/Image 从这里来
const FrameGraphAttachmentDatabase& attachmentDatabase = frameGraph.GetAttachmentDatabase();

Gems/Atom/Feature/Common/Assets/Passes/UIParent.pass


AZ::RPI::RenderPass::FrameBeginInternal(AZ::RPI::Pass::FramePrepareParams)
AZ::RPI::Pass::FrameBegin(AZ::RPI::Pass::FramePrepareParams)
AZ::RPI::ParentPass::FrameBeginInternal(AZ::RPI::Pass::FramePrepareParams)
AZ::RPI::Pass::FrameBegin(AZ::RPI::Pass::FramePrepareParams)
AZ::RPI::PassSystem::FrameUpdate(AZ::RHI::FrameGraphBuilder&)
void AZStd::Internal::function_util::get_invoker<void (AZ::RHI::FrameGraphBuilder&), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::RPI::RPISystem::RenderTick()::{lambda(AZ::RHI::FrameGraphBuilder&)#1}>(AZStd::Internal::function_util::function_buffer&, AZ::RHI::FrameGraphBuilder&)
AZ::RHI::RHISystem::FrameUpdate(AZStd::function<void (AZ::RHI::FrameGraphBuilder&)>)
AZ::RPI::RPISystem::RenderTick()
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()


Root Pass/ PassesWithoutPipeline:

AZ::RPI::ParentPass::Create(AZ::RPI::PassDescriptor const&)
AZ::RPI::PassSystem::Init()
AZ::RPI::RPISystem::Initialize(AZ::RPI::RPISystemDescriptor const&)
AZ::RPI::RPISystemComponent::Activate()
AZ::ModuleManager::ActivateEntities(AZStd::vector<AZStd::shared_ptr<AZ::ModuleDataImpl>, AZStd::allocator> const&)
void AZ::Internal::EBusContainer<AZ::EntityEvents, AZ::EntityEvents, (AZ::EBusAddressPolicy)1, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::EntityEvents, AZ::EntityEvents> >::Event<void (AZ::EntityEvents::*)(AZ::EntityId const&), AZ::EntityId&>(AZ::EntityId const&, void (AZ::EntityEvents::*&&)(AZ::EntityId const&), AZ::EntityId&)
AZ::Entity::Activate()
AzFramework::Application::StartCommon(AZ::Entity*)
AzToolsFramework::ToolsApplication::StartCommon(AZ::Entity*)
EditorInternal::EditorToolsApplication::StartCommon(AZ::Entity*)
AzToolsFramework::ToolsApplication::Start(AZ::ComponentApplication::Descriptor const&, AZ::ComponentApplication::StartupParameters const&)
EditorInternal::EditorToolsApplication::Start()
[bt] #13 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(CryEditMain+0x383) [0x7f112fe19cc3]

Parent Pass MainPipeline_0

AZ::RPI::SwapChainPass::SwapChainPass(AZ::RPI::PassDescriptor const&, AZ::RPI::WindowContext const*, AZ::RPI::ViewType)
AZ::RPI::RenderPipeline::CreateRenderPipelineForWindow(AZ::RPI::RenderPipelineDescriptor const&, AZ::RPI::WindowContext const&, AZ::RPI::ViewType)
AZ::Render::Bootstrap::BootstrapSystemComponent::LoadPipeline(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>, AZStd::basic_string_view<char, AZStd::char_traits<char> >, AZ::RPI::ViewType, AZ::RHI::MultisampleState&)
AZ::Render::Bootstrap::BootstrapSystemComponent::EnsureDefaultRenderPipelineInstalledForScene(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>)
AtomToolsFramework::RenderViewportWidget::SetScene(AZStd::shared_ptr<AzFramework::Scene> const&, bool)
[bt] #6 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget11UpdateSceneEv+0x83) [0x7f112f985093]
[bt] #7 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget13SetViewportIdEi+0x161) [0x7f112f989c91]
CLayoutViewPane::AttachViewport(QWidget*)
CLayoutViewPane::SetViewClass(QString const&)
CLayoutWnd::BindViewport(CLayoutViewPane*, QString const&, QWidget*)
CLayoutWnd::MaximizeViewport(int)
CLayoutWnd::LoadConfig()
[bt] #13 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow17InitCentralWidgetEv+0x174) [0x7f112fdb02b4]
[bt] #14 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow10InitializeEv+0x80) [0x7f112fdb3490]
[bt] #15 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp12InitInstanceEv+0x8f8) [0x7f112fe15f98]
[bt] #16 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(CryEditMain+0x47e) [0x7f112fe19dbe]


AZ::RPI::Scene::AddRenderPipeline(AZStd::shared_ptr<AZ::RPI::RenderPipeline>)
AZ::Render::Bootstrap::BootstrapSystemComponent::LoadPipeline(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>, AZStd::basic_string_view<char, AZStd::char_traits<char> >, AZ::RPI::ViewType, AZ::RHI::MultisampleState&)
AZ::Render::Bootstrap::BootstrapSystemComponent::EnsureDefaultRenderPipelineInstalledForScene(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>)
AtomToolsFramework::RenderViewportWidget::SetScene(AZStd::shared_ptr<AzFramework::Scene> const&, bool)
[bt] #5 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget11UpdateSceneEv+0x83) [0x7f76a6348093]
[bt] #6 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget13SetViewportIdEi+0x161) [0x7f76a634cc91]
CLayoutViewPane::AttachViewport(QWidget*)
CLayoutViewPane::SetViewClass(QString const&)
CLayoutWnd::BindViewport(CLayoutViewPane*, QString const&, QWidget*)
CLayoutWnd::MaximizeViewport(int)
CLayoutWnd::LoadConfig()
[bt] #12 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow17InitCentralWidgetEv+0x174) [0x7f76a67732b4]
[bt] #13 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow10InitializeEv+0x80) [0x7f76a6776490]
[bt] #14 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp12InitInstanceEv+0x8f8) [0x7f76a67d8f98]
[bt] #15 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(CryEditMain+0x47e) [0x7f76a67dcdbe]


AZ::RPI::PassSystem::AddRenderPipeline(AZ::RPI::RenderPipeline*)
AZ::RPI::Scene::AddRenderPipeline(AZStd::shared_ptr<AZ::RPI::RenderPipeline>)
AZ::Render::Bootstrap::BootstrapSystemComponent::LoadPipeline(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>, AZStd::basic_string_view<char, AZStd::char_traits<char> >, AZ::RPI::ViewType, AZ::RHI::MultisampleState&)
AZ::Render::Bootstrap::BootstrapSystemComponent::EnsureDefaultRenderPipelineInstalledForScene(AZStd::shared_ptr<AZ::RPI::Scene>, AZStd::shared_ptr<AZ::RPI::ViewportContext>)
AtomToolsFramework::RenderViewportWidget::SetScene(AZStd::shared_ptr<AzFramework::Scene> const&, bool)
[bt] #6 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget11UpdateSceneEv+0x83) [0x7fa207999093]
[bt] #7 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget13SetViewportIdEi+0x161) [0x7fa20799dc91]
CLayoutViewPane::AttachViewport(QWidget*)
CLayoutViewPane::SetViewClass(QString const&)
CLayoutWnd::BindViewport(CLayoutViewPane*, QString const&, QWidget*)
CLayoutWnd::MaximizeViewport(int)
CLayoutWnd::LoadConfig()
[bt] #13 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow17InitCentralWidgetEv+0x174) [0x7fa207dc42b4]
[bt] #14 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow10InitializeEv+0x80) [0x7fa207dc7490]
[bt] #15 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp12InitInstanceEv+0x8f8) [0x7fa207e29f98]
[bt] #16 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(CryEditMain+0x47e) [0x7fa207e2ddbe]


AZ::RPI::PassSystem::RemoveRenderPipeline(AZ::RPI::RenderPipeline*)
AZ::RPI::RenderPipeline::OnRemovedFromScene(AZ::RPI::Scene*)
AZ::RPI::Scene::RemoveRenderPipeline(AZ::Name const&)
AZ::RPI::PassSystem::FrameEnd()
AZ::RPI::RPISystem::RenderTick()
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()
[bt] #9 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp14IdleProcessingEb+0x101) [0x7fa207e21851]
[bt] #10 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp6OnIdleEi+0x3a) [0x7fa207e21b6a]
Editor::EditorQtApplication::maybeProcessIdle()

AZ::RPI::ParentPass::BuildInternal()
AZ::Render::EsmShadowmapsPass::BuildInternal()
AZ::RPI::Pass::Build(bool) [clone .part.0]
AZ::RPI::PassTree::BuildPasses()
AZ::RPI::PassTree::ProcessQueuedChanges()
AZ::RPI::RenderPipeline::UpdatePasses()
AZ::RPI::RenderPipeline::OnStartFrame(float)
AZ::RPI::Scene::PrepareRender(AZ::RHI::JobPolicy, float)
AZ::RPI::RPISystem::RenderTick() [clone .part.0]
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()

AZ::RPI::ParentPass::BuildInternal()
AZ::RPI::Pass::Build(bool) [clone .part.0]
AZ::RPI::ParentPass::BuildInternal()
AZ::RPI::SwapChainPass::BuildInternal() [clone .part.0]
AZ::RPI::Pass::Build(bool) [clone .part.0]
AZ::RPI::PassTree::BuildPasses()
AZ::RPI::PassTree::ProcessQueuedChanges()
AZ::RPI::RenderPipeline::UpdatePasses()
AZ::RPI::RenderPipeline::OnStartFrame(float)
AZ::RPI::Scene::PrepareRender(AZ::RHI::JobPolicy, float)
AZ::RPI::RPISystem::RenderTick() [clone .part.0]
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()

Root -> Pass.xxxx
AZ::RHI::FrameGraph::ExecuteAfter(AZ::Name const&)
AZ::RHI::FrameScheduler::PrepareProducers()
AZ::RHI::FrameScheduler::Compile(AZ::RHI::FrameSchedulerCompileRequest const&)
AZ::RHI::RHISystem::FrameUpdate(AZStd::function<void (AZ::RHI::FrameGraphBuilder&)>)
AZ::RPI::RPISystem::RenderTick() [clone .part.0]
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()


Pass.xxx -> Pass.yyy
AZ::RHI::FrameGraph::UseAttachmentInternal(AZ::RHI::ImageFrameAttachment&, AZ::RHI::ScopeAttachmentUsage, AZ::RHI::ScopeAttachmentAccess, AZ::RHI::ImageScopeAttachmentDescriptor const&)
AZ::RHI::FrameGraph::UseAttachment(AZ::RHI::ImageScopeAttachmentDescriptor const&, AZ::RHI::ScopeAttachmentAccess, AZ::RHI::ScopeAttachmentUsage)
AZ::RPI::RenderPass::DeclareAttachmentsToFrameGraph(AZ::RHI::FrameGraphInterface) const
AZ::RPI::RenderPass::SetupFrameGraphDependencies(AZ::RHI::FrameGraphInterface)
AZ::Render::ImGuiPass::SetupFrameGraphDependencies(AZ::RHI::FrameGraphInterface)
AZ::RHI::FrameScheduler::PrepareProducers()
AZ::RHI::FrameScheduler::Compile(AZ::RHI::FrameSchedulerCompileRequest const&)
AZ::RHI::RHISystem::FrameUpdate(AZStd::function<void (AZ::RHI::FrameGraphBuilder&)>)
AZ::RPI::RPISystem::RenderTick() [clone .part.0]
AZ::RPI::RPISystemComponent::OnSystemTick()
void AZ::Internal::EBusContainer<AZ::SystemTickEvents, AZ::SystemTickEvents, (AZ::EBusAddressPolicy)0, (AZ::EBusHandlerPolicy)1>::Dispatcher<AZ::EBus<AZ::SystemTickEvents, AZ::SystemTickEvents> >::Broadcast<void (AZ::SystemTickEvents::*)()>(void (AZ::SystemTickEvents::*&&)())
AZ::ComponentApplication::TickSystem()



pass->GetName()
pipeline->GetId()
scene->GetName()

pass 增加attachment
AttachBufferToSlot

引入连接关系到RHI
Pass::
FrameBegin -> Pass::ImportAttachments -> attachmentDatabase.ImportImage
                                               attachmentDatabase.ImportBuffer
                    Pass::CreateTransientAttachments -> attachmentDatabase.CreateTransientImage
                                                        attachmentDatabase.CreateTransientBuffer
                                                        
pass创建：
Ptr<Pass> PassFactory::CreatePassFromTemplate(Name templateName, Name passName)
PassSystemInterface::Get()->CreatePassFromTemplate(Name("Template"), Name("PassName"));

AddAttachmentBinding
m_name
m_slotType = PassSlotType::InputOutput

CommonBufferDescriptor cbd;
cbd.m_poolType = CommonBufferPoolType::ReadBack;
cbd.m_byteCount = 1024;
Data::Instance<Buffer> buf = BufferSystemInterface::Get()->CreateBufferFromCommonPool(cbd);

PassConnection
m_localSlot
m_attachmentRef

PassAttachmentRef ref;
m_pass
m_attachment

PassRequest
AddInputConnection(PassConnection inputConnection);
m_passName
m_templateName
m_imageAttachmentOverrides
m_bufferAttachmentOverrides
m_executeAfterPasses
m_executeBeforePasses

m_bufferDescriptor.m_byteCount
m_name
m_lifetime  AttachmentLifetimeType::Imported/Transient

connection可以连接到其他pass的slot，也可以连接到自己的image/buffer


BufferDescriptor
m_byteCount
m_bindFlags

ImageDescriptor
m_size
          uint32_t m_width = 1;
        uint32_t m_height = 1;
        uint32_t m_depth = 1;

m_bindFlags

RPI pass 处理：
1. add pass from request -> CreatePassFromRequest
2. add custom slot -> AddAttachmentBinding
3. add to parent -> root->AddChild(sp_0);

图构建
FrameBegin
Pass::Build, 将input/output关联到image/buffer
build -> SetupInputsFromRequest -> ProcessConnection

graph compile:
SetupFrameGraphDependencies -> UseAttachment -> insert edge


1、创建一个pass，增加slot
2、获取当前pass的slot，获取binding，UnifiedScopeAttachmentDescriptor m_unifiedScopeDesc m_attachmentId
3、修改连接关系



RenderTick -> Scene::PrepareRender -> RenderPipeline::OnStartFrame -> RenderPipeline::UpdatePasses -> PassTree::ProcessQueuedChanges -> PassTree::BuildPasses parent build, pass build -> SetupInputsFromRequest -> ProcessConnection -> UpdateConnectedBinding,SetOriginalAttachment
           -> RHI::FrameUpdate -> PassSystem::FrameUpdate -> RenderPipeline::PassSystemFrameBegin -> Pass::FrameBegin -> FrameScheduler::ImportScopeProducer
                                                                                                                      -> ImportAttachments
                                                                                                                      -> CreateTransientAttachments
           -> RHI::FrameScheduler::Compile -> FrameScheduler::PrepareProducers -> RenderPass::SetupFrameGraphDependencies ... -> FrameGraph::UseAttachment
           
           
修改pass依赖关系2种方式: template/request, request > template
pass的依赖关系与pass在pipeline上的顺序有关系

const PhysicalDevice& GetPhysicalDevice() 
const PhysicalDeviceDescriptor& GetDescriptor()

        AZStd::string m_description;
        PhysicalDeviceType m_type = PhysicalDeviceType::Unknown;
        VendorId m_vendorId = VendorId::Unknown;
        uint32_t m_deviceId = 0;
        uint32_t m_driverVersion = 0;
        
#include <AzCore/Debug/CStackTrace.h>


多device:
1、RPISystem::Initialize:
m_querySystem.Init(m_descriptor.m_gpuQuerySystemDescriptor);
CacheFeatureSupport:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/GpuQuery/GpuQuerySystem.cpp:102
QueryPool:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/GpuQuery/QueryPool.cpp:54

2、RPISystem::InitializeSystemAssets:
Init:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Image/ImageSystem.cpp:138
CreateDefaultResources:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Image/ImageSystem.cpp:438
Init:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Buffer/BufferSystem.cpp:41
 CreateCommonBufferPool:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Buffer/BufferSystem.cpp:99
 
3、scene/view初始化
Init:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Shader/ShaderResourceGroupPool.cpp:52
AZ::RPI::ShaderResourceGroup::Create(AZ::Data::Asset<AZ::RPI::ShaderAsset> const&, AZ::Name const&)
[bt] #0 thread 245983 Init:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Shader/ShaderResourceGroupPool.cpp:52 info [None]
AZ::RPI::ShaderResourceGroupPool::CreateInternal(AZ::RPI::ShaderAsset&, AZStd::any const*)
AZStd::intrusive_ptr<AZ::RPI::ShaderResourceGroupPool> AZStd::Internal::function_util::get_invoker<AZStd::intrusive_ptr<AZ::RPI::ShaderResourceGroupPool> (AZ::Data::AssetData*, AZStd::any const*), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::RPI::ShaderSystem::Init()::{lambda(AZ::Data::AssetData*, AZStd::any const*)#3}>(AZStd::Internal::function_util::function_buffer&, AZ::Data::AssetData*&&, AZStd::any const*&&)
AZ::Data::InstanceDatabase<AZ::RPI::ShaderResourceGroupPool>::EmplaceInstance(AZ::Data::InstanceId const&, AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::Data::InstanceDatabase<AZ::RPI::ShaderResourceGroupPool>::FindOrCreate(AZ::Data::InstanceId const&, AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::RPI::ShaderResourceGroupPool::FindOrCreate(AZ::Data::Asset<AZ::RPI::ShaderAsset> const&, AZ::RHI::Handle<unsigned int, AZ::RPI::ShaderAsset> const&, AZ::Name const&)
AZ::RPI::ShaderResourceGroup::Init(AZ::RPI::ShaderAsset&, AZ::RHI::Handle<unsigned int, AZ::RPI::ShaderAsset> const&, AZ::Name const&) [clone .part.0]
AZ::RPI::ShaderResourceGroup::CreateInternal(AZ::RPI::ShaderAsset&, AZStd::any const*)
AZStd::intrusive_ptr<AZ::RPI::ShaderResourceGroup> AZStd::Internal::function_util::get_invoker<AZStd::intrusive_ptr<AZ::RPI::ShaderResourceGroup> (AZ::Data::AssetData*, AZStd::any const*), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::RPI::ShaderSystem::Init()::{lambda(AZ::Data::AssetData*, AZStd::any const*)#2}>(AZStd::Internal::function_util::function_buffer&, AZ::Data::AssetData*&&, AZStd::any const*&&)
AZ::Data::InstanceDatabase<AZ::RPI::ShaderResourceGroup>::EmplaceInstance(AZ::Data::InstanceId const&, AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::Data::InstanceDatabase<AZ::RPI::ShaderResourceGroup>::Create(AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::RPI::ShaderResourceGroup::Create(AZ::Data::Asset<AZ::RPI::ShaderAsset> const&, AZ::Name const&)
AZ::RPI::View::TryCreateShaderResourceGroup() [clone .part.0]
AZ::RPI::View::View(AZ::Name const&, AZ::RPI::View::UsageFlags)
AZ::RPI::View::CreateView(AZ::Name const&, AZ::RPI::View::UsageFlags)
AZ::RPI::ViewGroup::CreateMainView(AZ::Name) [clone .part.0]
AZ::RPI::ViewportContextManager::GetOrCreateViewStackForContext(AZ::Name const&)
AZ::RPI::ViewportContextManager::RegisterViewportContext(AZ::Name const&, AZStd::shared_ptr<AZ::RPI::ViewportContext>)
AZ::RPI::ViewportContextManager::CreateViewportContext(AZ::Name const&, AZ::RPI::ViewportContextRequestsInterface::CreationParameters const&)
AtomToolsFramework::RenderViewportWidget::InitializeViewportContext(int) [clone .part.0]


LoadPipelineLibrary:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Shader/Shader.cpp:295
[bt] #0 thread 245983 GetPipelineLibraryPath:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Shader/Shader.cpp:92 info [None]
AZ::RPI::Shader::CreateInternal(AZ::RPI::ShaderAsset&, AZStd::any const*)
AZStd::intrusive_ptr<AZ::RPI::Shader> AZStd::Internal::function_util::get_invoker<AZStd::intrusive_ptr<AZ::RPI::Shader> (AZ::Data::AssetData*, AZStd::any const*), AZStd::Internal::function_util::function_obj_tag, AZStd::allocator>::call<AZ::RPI::ShaderSystem::Init()::{lambda(AZ::Data::AssetData*, AZStd::any const*)#1}>(AZStd::Internal::function_util::function_buffer&, AZ::Data::AssetData*&&, AZStd::any const*&&)
AZ::Data::InstanceDatabase<AZ::RPI::Shader>::EmplaceInstance(AZ::Data::InstanceId const&, AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::Data::InstanceDatabase<AZ::RPI::Shader>::FindOrCreate(AZ::Data::InstanceId const&, AZ::Data::Asset<AZ::Data::AssetData> const&, AZStd::any const*)
AZ::RPI::Shader::FindOrCreate(AZ::Data::Asset<AZ::RPI::ShaderAsset> const&, AZ::Name const&)
AZ::RPI::LoadShader(AZ::Data::AssetId, AZStd::basic_string<char, AZStd::char_traits<char>, AZStd::allocator> const&, AZStd::basic_string<char, AZStd::char_traits<char>, AZStd::allocator> const&)
AZ::RPI::LoadCriticalShader(AZStd::basic_string<char, AZStd::char_traits<char>, AZStd::allocator> const&, AZStd::basic_string<char, AZStd::char_traits<char>, AZStd::allocator> const&)
AZ::Render::DiffuseProbeGridFeatureProcessor::Activate()
AZ::RPI::Scene::Activate()
AZ::Render::Bootstrap::BootstrapSystemComponent::GetOrCreateAtomSceneFromAzScene(AzFramework::Scene*)
AtomToolsFramework::RenderViewportWidget::SetScene(AZStd::shared_ptr<AzFramework::Scene> const&, bool)
[bt] #12 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget11UpdateSceneEv+0x83) [0x7fcd27885133]
[bt] #13 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN20EditorViewportWidget13SetViewportIdEi+0x161) [0x7fcd27889d31]
CLayoutViewPane::AttachViewport(QWidget*)
CLayoutViewPane::SetViewClass(QString const&)
CLayoutWnd::BindViewport(CLayoutViewPane*, QString const&, QWidget*)
CLayoutWnd::MaximizeViewport(int)
CLayoutWnd::LoadConfig()
[bt] #19 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow17InitCentralWidgetEv+0x174) [0x7fcd27cb0354]
[bt] #20 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN10MainWindow10InitializeEv+0x80) [0x7fcd27cb3530]
[bt] #21 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(_ZN11CCryEditApp12InitInstanceEv+0x8f8) [0x7fcd27d16038]
[bt] #22 /home/kai/o3deprj/O3DE/Projects/MyProject/build/linux/bin/release/libEditorLib.so(CryEditMain+0x47e) [0x7fcd27d19e5e]

4、draw packet:
SetDrawListTag:/mnt/work/o3de/Gems/Atom/RPI/Code/Source/RPI.Public/Pass/RasterPass.cpp:106
